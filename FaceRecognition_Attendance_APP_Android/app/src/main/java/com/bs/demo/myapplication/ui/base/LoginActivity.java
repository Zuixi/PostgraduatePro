package com.bs.demo.myapplication.ui.base;import android.os.Bundle;import android.support.v7.widget.CardView;import android.text.TextUtils;import android.view.View;import android.widget.EditText;import android.widget.TextView;import com.bs.demo.myapplication.R;import com.bs.demo.myapplication.common.base.BaseActivity;import com.bs.demo.myapplication.common.base.LocalBeanInfo;import com.bs.demo.myapplication.common.base.LocalRemark;import com.bs.demo.myapplication.model.ImGetTokenBean;import com.bs.demo.myapplication.model.UserInfoBean;import com.bs.demo.myapplication.utils.HttpUtil;import com.bs.demo.myapplication.utils.LogUtil;import com.google.gson.Gson;import io.rong.imkit.RongIM;import io.rong.imlib.model.UserInfo;public class LoginActivity extends BaseActivity {    private EditText edt_login_account;    private EditText edt_login_pwd;    private CardView cv_login;    private TextView tv_login_reg;    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        setContentView(R.layout.activity_login);        initView();    }    private void initView() {        edt_login_account = (EditText) findViewById(R.id.edt_login_account);        edt_login_pwd = (EditText) findViewById(R.id.edt_login_pwd);        cv_login = (CardView) findViewById(R.id.cv_login);        tv_login_reg = (TextView) findViewById(R.id.tv_login_reg);        cv_login.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View v) {                submit();            }        });        tv_login_reg.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View v) {                startAct(RegisterActivity.class);            }        });        LocalBeanInfo.refreshUserInfo(null);    }    private void submit() {        String account = edt_login_account.getText().toString().trim();        if (TextUtils.isEmpty(account)) {            showToast(edt_login_account.getHint().toString());            return;        }        String pwd = edt_login_pwd.getText().toString().trim();        if (TextUtils.isEmpty(pwd)) {            showToast(edt_login_pwd.getHint().toString());            return;        }        HttpUtil.newInstance()                .addParam("account", account)                .addParam("password", pwd)                .post("login", new HttpUtil.HttpListener() {                    @Override                    public void onSuccess(String t) {                        final UserInfoBean userInfoBean=new Gson().fromJson(t,UserInfoBean.class);                        if (userInfoBean.getLogo()==null){                            userInfoBean.setLogo("");                        }                        if (userInfoBean.getName()==null){                            userInfoBean.setName("");                        }                        HttpUtil.newInstance()                                .addParam("userId", userInfoBean.getId())                                .addParam("name", userInfoBean.getName())                                .addParam("portraitUri",userInfoBean.getLogo()==null?"":userInfoBean.getLogo())                                .postIM("http://api-cn.ronghub.com/user/getToken.json", new HttpUtil.HttpListener() {                                    @Override                                    public void onSuccess(String t) {                                        ImGetTokenBean imGetTokenBean=new Gson().fromJson(t,ImGetTokenBean.class);                                        LocalRemark.remark(imGetTokenBean.getToken(),LocalRemark.KEY_TOKEN);                                        showToast("登录成功!");                                        LocalBeanInfo.refreshUserInfo(userInfoBean);                                        startAct(MainActivity.class);                                        finish();                                    }                                    @Override                                    public void onError(String msg) {                                        showToast("登录失败!");                                    }                                });                    }                    @Override                    public void onError(String msg) {                        showToast("登录失败!");                    }                });    }}